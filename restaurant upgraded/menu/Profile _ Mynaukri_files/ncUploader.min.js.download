define(["exports"],function(a){"use strict";function b(a){var b,c,g=[],h=function(f){return f.params=a,c=a.maxNumOfFiles||0,g=a.fileKeys,i()?(e.prototype=f,b=new e):(c=f.params.maxNumOfFiles=1,d.prototype=f,b=new d),$("#"+f.params.fileId).on("change",b.upload),$.isEmptyObject(f.params.plugins)===!1&&j(a,b.pluginCallback,b.isUploadAllowed,b.getFileKey),b},i=function(){return a.forceBasicUploader!==!0&&"undefined"!=typeof File&&"undefined"!=typeof FileList},j=function(a,b,c,d){for(var e in a.plugins)f.call(window,e,a,b,c,d)},k=function(b,c){var d={appId:a.appId,formKey:a.formKey,fileKey:b},e=a.targets.deleteUrl;$.post(e,d,function(){},"json").done(function(d,e,f){"undefined"!=typeof d[b].ERROR&&(callbackArguments={ERROR:{}},callbackArguments.ERROR[b]={name:c,error:"DELETE_ERROR "+d[b].ERROR},a.callback.call(window,callbackArguments))})};this.pluginCallback=function(b,c){var d={};if("success"===b){l("dec");d={SUCCESS:[]},c&&(d.SUCCESS=c,a.callback.call(window,d))}else"error"===b?(d={ERROR:[]},c&&(d.ERROR=c,a.callback.call(window,d))):"limitExceed"===b?(d={ERROR:"MAX LIMIT REACHED"},a.callback.call(window,d)):"selectionExceeded"===b?(d={ERROR:"SELECTION EXCEEDED"},a.callback.call(window,d)):"remove"===b&&this.deleteFile(c.fileKey,c.name)},this.deleteFile=function(b,c,d){l("inc",d),a.preventAddFileKeyInStack||g.push(b),k(b,c)};var l=function(b,d){if(d=d||!1,"inc"==b){if(c++,1===c&&!d){for(var e in a.plugins)$("#"+a.plugins[e].buttonId).show();$("#"+a.fileId).show()}c===a.maxNumOfFiles&&$("#"+a.outputHolder.id).hide()}if("dec"==b&&(a.maxNumOfFiles>1&&c--,0===c)){document.ajaxq&&(document.ajaxq.q.uploadqueue=[]);for(var e in a.plugins)$("#"+a.plugins[e].buttonId).hide();$("#"+a.dropAreaParams.id).hide(),$("#"+a.fileId).hide()}};return this.isUploadAllowed=function(){if(c<=0)return!1},this.getFileKey=function(){var b=a.maxNumOfFiles>1?g.pop():g;return b},h(this)}var c={getRandomString:function(){return(new Date).getTime()+"_"+(Math.random()+"").replace(".","_")},cancel:function(){document.ajaxq.r&&document.ajaxq.r.abort()}},d=function(){var a=function(a){return d=a,e=b(),$("#"+d.params.containerId).show(),d},b=function(){return $("#"+d.params.fileId)[0]};this.upload=function(){if(e=b(),e.value){var a=f();if(!a.isValid)return void d.params.callback.call(window,a.callbackArguments);g();var c=j(),h=k();l(c,h)}};var d,e,f=function(){var a=!0,b={};b={ERROR:[]};var c=!1,f=e.value.slice(e.value.lastIndexOf(".")+1).toLowerCase();if(f!=e.value)for(var g=0;g<d.params.extensions.length;++g)if(f==d.params.extensions[g]){c=!0;break}return c||(a=!1,b.ERROR={dummyFileKey:{error:"INVALID_EXTENSION"}}),{isValid:a,callbackArguments:b}},g=function(){$("#"+d.params.basicProgressBarId).show()},h=function(){return $("<input>").attr({type:"hidden",name:"uploadCallbackUrl",value:(location.origin||location.protocol+"//"+location.host)+d.params.callbackUrl})[0]},i=function(){var a="uploadCallback_"+c.getRandomString();return function(b){window[a]=function(){document.getElementById(b.params.basicProgressBarId).style.display="none","undefined"!=typeof b.params.callback&&b.params.callback.apply(window,arguments)}}(d),$("<input>").attr({type:"hidden",name:"uploadCallback",value:a})[0]},j=function(){var a="form_"+c.getRandomString(),b=$("<form>").attr({id:a,method:"POST",enctype:"multipart/form-data",action:d.params.targets.saveFileUrl}),e=$("#"+d.params.fileId);$(e.clone(!0)).insertBefore(e.next()),e.off("change"),e.hide();var f=$("<input>").attr({type:"hidden",name:"appId",value:d.params.appId});return b.append(e).append(f).append(h()).append(i()).appendTo("body"),a},k=function(){var a="iframe_"+c.getRandomString();return $('<iframe name="'+a+'">').attr({style:"position: absolute; top: -1000px; left: -1000px"}).appendTo("body"),a},l=function(a,b){$("#"+a).attr("target",b).submit()};return a(this)},e=function(){var a,b,d=function(b){return a=b,$("#"+a.params.containerId).show(),a.params.dropAreaParams&&a.params.dropAreaParams.id&&e($("#"+a.params.dropAreaParams.id)),a},e=function(b){b.on("drop",function(b){b.preventDefault(),a.params.files=b.originalEvent.dataTransfer.files,a.upload()}),b.on("dragover",function(){return b.addClass(a.params.dropAreaParams.onHoverCssClass),!1}),b.on("dragleave",function(){return b.removeClass(a.params.dropAreaParams.onHoverCssClass),!1}),b.show()},f=function(a){var b,c=a.hasClass("materialize");return b=c?function(b){if(b.lengthComputable){var c=b.loaded/b.total*100;a.find(".determinate").width(c+"%")}}:function(b){b.lengthComputable&&a.attr({value:b.loaded,max:b.total})}};this.upload=function(){if(0==a.isUploadAllowed())return void a.pluginCallback("limitExceed");if(b="undefined"==typeof a.params.files?$("#"+a.params.fileId)[0].files:a.params.files,b.length){if(b.length>a.params.maxNumOfFiles)return void a.pluginCallback("selectionExceeded");for(var c={appId:a.params.appId,uploadCallback:a.params.callback},d=0;d<b.length;++d){var e=g(b[d]);e.isValid?($("#"+a.params.outputHolder.id).show(),h(c,b[d])):a.params.callback.call(window,e.callbackArguments)}}};var g=function(b){var c=!0,d=!1,e={};e={};var f=a.params.extensions,g=b.name.slice(b.name.lastIndexOf(".")+1).toLowerCase();if(g!=b.value)for(var h=0;h<f.length;++h)if(g==f[h]){d=!0;break}return d||(c=!1,e.ERROR={dummyFileKey:{name:b.name,error:"INVALID_EXTENSION"}}),b.size>a.params.maxSize&&(c=!1,e.ERROR={dummyFileKey:{name:b.name,error:"FILE SIZE LIMIT EXCEEDED"}}),{isValid:c,callbackArguments:e}},h=function(b,d){var e,g=new FormData,h=c.getRandomString();for(name in b)g.append(name,b[name]);$.ajaxq("uploadqueue",{type:"POST",method:"POST",url:a.params.targets.saveFileUrl,enctype:"multipart/form-data",data:g,processData:!1,contentType:!1,dataType:"json",xhrFields:{withCredentials:!1},beforeSend:function(){"function"==typeof a.params.beforeSendCallback&&a.params.beforeSendCallback();var b=$('<progress class="progress">');a.params.materializeLoader&&(b=$('<span class="progress materialize"><span class="determinate"></span></span>'));var f=$("<li>").attr({id:h}).html("<div>"+d.name+"</div>").append(b).append($("<button>").on("click",function(){c.cancel(),$("#"+h).remove()}));a.params.outputHolder&&$("#"+a.params.outputHolder.id).append(f),e=a.getFileKey(),g.append(a.params.formKey+"["+e+"]",d)},error:function(b,c,e){a.pluginCallback("error",{dummyFileKey:{name:d.name,error:e}})},success:function(b,c,e){var f={};for(var g in b)"undefined"!=typeof b[g].ERROR?(f[g]={name:d.name,error:b[g].ERROR},a.pluginCallback("error",f),$("#"+h).remove()):(f[g]={name:d.name,URL:b[g].URL},a.pluginCallback("success",f),$("#"+h+">button").unbind("click").bind("click",function(){a.pluginCallback("remove",{fileKey:g,name:d.name}),$("#"+h).remove(),a.params.onDelete?a.params.onDelete():""}))},xhr:function(){var a=$.ajaxSettings.xhr();return a.upload&&a.upload.addEventListener("progress",f($("#"+h+">.progress")),!1),a},complete:function(){var a=$("#"+h+">.progress");a.hasClass("materialize")?$("#"+h).remove():a.hide()}})};return d(this)},f=function(a,b,d,e,f){var g=function(c){c.params=b,c.isUploadAllowed=e;window[a](b.plugins[a]);return c};return this.serverHit=function(a){var e,g=c.getRandomString();if(a.fileLink){var h={appId:b.appId,uploadCallback:b.callback.toString(),formKey:b.formKey,filename:a.fileName,url:a.fileLink};$("#"+b.outputHolder.id).show(),"undefined"!=typeof a.fileToken&&(h.access_token=a.fileToken),$.ajaxq("uploadqueue",{type:"POST",method:"POST",url:b.targets.saveCloudUrl,data:h,dataType:"json",xhrFields:{withCredentials:!1},beforeSend:function(d,h){var i=$("<li>").attr({id:g}).html("<div>"+a.fileName+"</div>").append($("#"+b.basicProgressBarId).clone().show()).append($("<button>").on("click",function(){c.cancel(),$("#"+g).remove()}));b.outputHolder&&$("#"+b.outputHolder.id).append(i),e=f(),h.data=h.data+"&fileKey="+e},success:function(b,c,e){var f={};for(var h in b)"undefined"!=typeof b[h].ERROR?(f[h]={name:a.fileName,error:b[h].ERROR},d("error",f),$("#"+g).remove()):(f[h]={name:a.fileName,URL:b[h].URL},d("success",f),$("#"+g+">button").unbind("click").bind("click",function(){d("remove",{fileKey:h,name:a.fileName}),$("#"+g).remove(),me.params.onDelete?me.params.onDelete():""}))},error:function(b,c,e){d("error",{dummyFileKey:{name:a.fileName,error:e}})},complete:function(){$("#"+g+">img").hide()}})}},this.validateBeforeUpload=function(a,c){var d=!0,e=!1,f={};f={};for(var g=b.extensions,h=a.slice(a.lastIndexOf(".")+1).toLowerCase(),i=0;i<g.length;++i)if(h==g[i]){e=!0;break}return e||(d=!1,f.ERROR={dummyFileKey:{name:a,error:"INVALID_EXTENSION"}}),"undefined"!=typeof c&&c>b.maxSize&&(d=!1,f.ERROR={dummyFileKey:{name:a,error:"FILE SIZE LIMIT EXCEEDED"}}),{isValid:d,callbackArguments:f}},g(this)};jQuery.ajaxq=function(a,b){if("undefined"==typeof document.ajaxq&&(document.ajaxq={q:{},r:null}),"undefined"==typeof document.ajaxq.q[a]&&(document.ajaxq.q[a]=[]),"undefined"!=typeof b){var c={};for(var d in b)c[d]=b[d];b=c;var e=b.complete;b.complete=function(b,c){document.ajaxq.q[a].shift(),document.ajaxq.r=null,e&&e(b,c),document.ajaxq.q[a].length>0&&(document.ajaxq.r=jQuery.ajax(document.ajaxq.q[a][0]))},document.ajaxq.q[a].push(b),1==document.ajaxq.q[a].length&&(document.ajaxq.r=jQuery.ajax(b))}else document.ajaxq.r&&(document.ajaxq.r.abort(),document.ajaxq.r=null),document.ajaxq.q[a]=[]},a.ncUploader=b,Object.defineProperty(a,"__esModule",{value:!0})});