define(function(){"use strict";window.commonValidator=function(){var a=!1,b={validate:function(a){var c=b;c.onErr=a.onError||null,c.onValid=a.onValid||null,c.befSbt=a.beforeSubmit||null,c.disSbt=a.disableSubmit||null,c.lastErr=null,c.isVld=null,c.erArry={},c.erArryExt={},c.noVld=!1,c.errs=a.errors||commonErrList,c.cFocus=a.clearOnFocus||!1,c.eFocus=a.focusOnError!==!1;var d=a.inlineErrors!==!1;if(a.messageBox)var e=a.messageBox.id||null,f=a.messageBox.content||null,g=a.messageBox.hideOthers||!1;else var e,f=null;if(a.styles){var h=a.styles.errorClass||null,i=a.styles.okClass||null,j=a.styles.softMandClass||null;k=a.styles.parentObjectClass||null,l=a.styles.maxLevel||1}else var h="err",i="ok",j="softMand",k=null,l=1;var m=a.formNames||null,n=a.defaultEvents||null,o=a.submitButton||null,p=a.fireDelay||0;if(m.constructor===Array)for(var q=0;q<m.length;q++)c.validInit(m[q],o,h,i,j,k,l,e,f,g,d,n,p);else c.validInit(m,o,h,i,j,k,l,e,f,g,d,n,p)},validInit:function(c,d,e,f,g,h,i,j,k,l,m,n,o){var p,q,r,s=b,t=$("form[name="+c+"]").get(0);if(!t){var u=new Error(c);throw u.name="CommonValidator Form",u}if(s.fName=c,s[c]={pExist:h,pLevel:i},s.checkEvents(t,e,f,g,m,n),d){var v=s.getSbtBtns($(t),d,!0),w=v[1];for(q=v[0],p=0;p<q.length;p++)"submit"!=q[p].attr("type")&&(""!=q[p].attr("rel")&&"noValidate"==q[p].attr("rel")?$(t).on("click",w,function(){s.noVld=!0,$(t).submit()}):$(t).on("click",w,function(){setTimeout(function(){s.isVld=s.checkSubmit(t,d,e,f,g,j,k,l,m)},parseInt(o))}))}$(t).submit(function(){return a=!0,0===parseInt(o)?(r=!!s.noVld||s.checkSubmit(t,d,e,f,g,j,k,l,m),s.befSbt&&s.befSbt({err:s.erArryExt,formName:c,isSubmit:a}),a=!1,!s.disSbt&&r):(setTimeout(function(){r=!!s.noVld||s.checkSubmit(t,d,e,f,g,j,k,l,m),s.befSbt&&s.befSbt({err:s.erArryExt,formName:c,isSubmit:a}),!s.disSbt&&r&&(s.sanitizeDefaultValues(t),$(t).get(0).submit()),a=!1},parseInt(o)),!1)})},setDefaultValues:function(a){var c,d=b,e=a?$(a):$("form[name="+d.fName+"]"),f=d.getFrmElms($(e),!0);for(c=0;c<f.length;c++)""!=f[c].val()&&f[c].val()!=f[c].attr("placeholder")||(f[c].val(f[c].attr("placeholder")),f[c].css({color:"#a9a9a9"})),f[c].on("focus blur",function(a){g(a,$(this))});var g=function(a,b){b.val()==b.attr("placeholder")&&"focus"==a.type?(b.val(""),b.css({color:""})):""!=b.val()&&b.val()!=b.attr("placeholder")||"blur"!=a.type||(b.val(b.attr("placeholder")),b.css({color:"#a9a9a9"}))}},sanitizeDefaultValues:function(a){var c,d=b,e=a?$(a):$("form[name="+d.fName+"]"),f=d.getFrmElms($(e),!0);for(c=0;c<f.length;c++)f[c].val()==f[c].attr("placeholder")&&f[c].val("")},checkEvents:function(a,c,d,e,f,g){var h,i,j=b,k=null,l=j.getFrmElms($(a),!1);for(h=0;h<l.length;h++){var m=l[h].attr("rel").split("|")[0];if((l[h].attr("rel").split("|")[1]||g)&&(g&&(g.constructor===Array?"":g=new Array(g)),k=l[h].attr("rel").split("|")[1]?l[h].attr("rel").split("|")[1].split(","):g))for(i=0;i<k.length;i++)l[h].on(k[i],function(a,b,c,d,e,g){return function(h){j.checkValids(a,b,h,c,d,e,g,f)}}(m,l[h],a,c,d,e));j.cFocus&&l[h].on("focus",function(a,b,c,d,e,f){return function(g){j.clearError(g,a,b,c,d,e,f,!0)}}(m,l[h],a,c,d,e))}},checkSubmit:function(a,c,d,e,f,g,h,i,j){var k,l,m,n,o,p=b,q=!1,r=p.getFrmElms($(a),!1),s=p.getSbtBtns($(a),c);for(i?$(".mgBox").hide():"",$(a).attr("chk",!1),p.erArry={},p.erArryExt={},k=0;k<s.length;k++)""!=s[k].attr("rel")&&$.trim(s[k].attr("rel")).length&&"noValidate"!=s[k].attr("rel")&&(o="custom:"+s[k].attr("rel").split("|")[0],n=p.checkValids(o,s[k],"submit",a,d,e,f,j),q||n||(q=!0));for(l=r.length-1;l>=0;l--)m=r[l].attr("rel").split("|")[0],n=p.checkValids(m,r[l],"submit",a,d,e,f,j),q||n||(q=!0);if(p.lastErr&&"true"==$(a).attr("chk")){if(g){if($("#"+g+"_cMsgCnt")?$("#"+g+"_cMsgCnt").remove():"",h){var t,u=[],v=$("<div>");v.attr("id",g+"_cMsgCnt");for(t in p.erArry)u.push(p.erArry[t]);if(h.customContent){var w=h.customContent,x=$("<p>");x.html(w),v.append(x)}if(h.errorMessages){var l,y=$("<ul>");for(l=u.length-1;l>=0;l--){var z=$("<li>");z.html(u[l]),y.append(z)}v.append(y)}if(h.errorCount){var A=h.errorCount,B=$("<p>");A=1!=A?A.replace("[errCount]",u.length):"Total "+u.length+" errors found in the form.",B.html(A),v.append(B)}$("#"+g).append(v)}$("#"+g).show()}p.eFocus&&(p.lastErr.obj?$(p.lastErr.objCont).focus():p.lastErr.focus())}else g?$("#"+g).hide():"";return!q},clearError:function(a,c,d,e,f,g,h){var i,j=b,k=c.split(","),l="";for(i=0;i<k.length;i++)l=j.errs[k[i].split(":")[1]]||k[i].split(":")[1],l.constructor===Function&&(l=l(d)),j.heighlightErrOk(l,d,e,"rem",f,g,h)},isValid:function(a){var c,d,e=b,f=a?$("#"+a):$("form[name="+e.fName+"]"),g=!1;if("form"==f.get(0).nodeName.toLowerCase()){var h=e.getFrmElms(f,!1);for(c=h.length-1;c>=0;c--)"button"!=h[c].attr("type")&&"submit"!=h[c].attr("type")&&""!=h[c].attr("rel")&&h[c].attr("rel").split("|")[0].indexOf("softReq")<0&&(d=h[c].attr("rel").split("|")[0],g||e.checkValids(d,h[c])&&(g=!0));return!g}if(""!=f.attr("rel")){var i=f.attr("rel").split("|")[0];return!e.checkValids(i,f)}},isValidSrv:function(a){function c(a,b,c,f,g,h,i,j,k,l,m){switch(a){case"required":return e.reqChk(b,m);case"alphaDS":return e.alphadsChk(b,m);case"alpha":return e.alphaChk(b,m);case"num":return e.numChk(b,m);case"float":return e.floatChk(b,m);case"alphanum":return e.alphanumChk(b,m);case"email":return e.emailChk(b,m);case"specialChar":return e.splChk(b,m);case"charRange":return e.rangeChk(b,g,h,k);case"valRange":return e.rangeVChk(b,i,j,k);case"checked":return e.checkedChkSrv(b);case"selected":return e.selectedChkSrv(b,f);case"custom":var n=d.errs[m];fn=this[n.func];var o=fn.apply(this,n.fields);return"object"==typeof o&&0==o.msg&&(o=""),o}}var d=b,e=d.validators;d.errs=a.custom||{},d.errs.__proto__=commonErrList;for(var f=a.name,g=a.val||"",h=a.custom||null,i="",j=arr[f],k=j.rel.split(","),l=j.defVal||null,m=j.defSelected||"-1",n=j.minL||null,o=j.maxL||null,p=j.minV||null,q=j.maxV||null,r=j.scope||"in",s=0;s<k.length;)if(c(k[s].split(":")[0],g,l,m,n,o,p,q,r,h,k[s].split(":")[1])){if(i+=f+":"+k[s].split(":")[0]+">"+k[s].split(":")[1]+">","custom"!=k[s].split(":")[0]){var t=d.errs[k[s].split(":")[1]].msg?d.errs[k[s].split(":")[1]].msg:d.errs[k[s].split(":")[1]];i+=t.replace("[currVal]",g).replace("[MinL]",n).replace("[MaxL]",o).replace("[MinV]",p).replace("[MaxV]",q)}else i+=c("custom",g,"","","","","","","",h,k[s].split(":")[1]);s=k.length+1,i+=","}else s++;return i+=";",0==i.lastIndexOf(";")&&(i=""),i},checkValids:function(a,c,d,e,f,g,h,i){var j,k=b,l=!1,m=0,n=!1,o=!1;if(2==arguments.length?(l=!0,m=1):9!=d.keyCode&&16!=d.keyCode&&17!=d.keyCode&&18!=d.keyCode&&35!=d.keyCode&&36!=d.keyCode&&27!=d.keyCode&&20!=d.keyCode&&13!=d.keyCode&&(m=1),1==m){var p,q=!1,r="",s=a.split(",");for(p=0;p<s.length;p++)if(!q)switch(s[p].split(":")[0]){case"softReq":j=c.attr("placeholder")&&c.val()==c.attr("placeholder")?"":c.val(),l?n?"":n=k.validators.reqChk(j,s[p].split(":")[1]):(q=k.validators.reqChk(j,s[p].split(":")[1]),r=s[p].split(":")[1],o=!!q);break;case"required":j=c.attr("placeholder")&&c.val()==c.attr("placeholder")?"":c.val(),l?n?"":n=k.validators.reqChk(j,s[p].split(":")[1]):(q=k.validators.reqChk(j,s[p].split(":")[1]),r=s[p].split(":")[1]);break;case"alphaDS":c.attr("placeholder")&&c.val()==c.attr("placeholder")?q=!1:l?n?"":n=k.validators.alphadsChk(c.val(),s[p].split(":")[1]):(q=k.validators.alphadsChk(c.val(),s[p].split(":")[1]),r=s[p].split(":")[1]);break;case"alpha":c.attr("placeholder")&&c.val()==c.attr("placeholder")?q=!1:l?n?"":n=k.validators.alphaChk(c.val(),s[p].split(":")[1]):(q=k.validators.alphaChk(c.val(),s[p].split(":")[1]),r=s[p].split(":")[1]);break;case"num":c.attr("placeholder")&&c.val()==c.attr("placeholder")?q=!1:l?n?"":n=k.validators.numChk(c.val(),s[p].split(":")[1]):(q=k.validators.numChk(c.val(),s[p].split(":")[1]),r=s[p].split(":")[1]);break;case"float":c.attr("placeholder")&&c.val()==c.attr("placeholder")?q=!1:l?n?"":n=k.validators.floatChk(c.val(),s[p].split(":")[1]):(q=k.validators.floatChk(c.val(),s[p].split(":")[1]),r=s[p].split(":")[1]);break;case"alphanum":c.attr("placeholder")&&c.val()==c.attr("placeholder")?q=!1:l?n?"":n=k.validators.alphanumChk(c.val(),s[p].split(":")[1]):(q=k.validators.alphanumChk(c.val(),s[p].split(":")[1]),r=s[p].split(":")[1]);break;case"email":c.attr("placeholder")&&c.val()==c.attr("placeholder")?q=!1:l?n?"":n=k.validators.emailChk(c.val(),s[p].split(":")[1]):(q=k.validators.emailChk(c.val(),s[p].split(":")[1]),r=s[p].split(":")[1]);break;case"specialChar":c.attr("placeholder")&&c.val()==c.attr("placeholder")?q=!1:l?n?"":n=k.validators.splChk(c.val(),s[p].split(":")[1]):(q=k.validators.splChk(c.val(),s[p].split(":")[1]),r=s[p].split(":")[1]);break;case"charRange":if(c.attr("placeholder")&&c.val()==c.attr("placeholder"))q=!1;else{var t=c,u=t.attr("minL")?t.attr("minL"):t.attr("minlength"),v=t.attr("maxL")?t.attr("maxL"):t.attr("maxlength"),w="";w=t.attr("scope")&&""!=t.attr("scope")?t.attr("scope"):"in",l?n?"":n=k.validators.rangeChk(t.val(),u,v,w):(q=k.validators.rangeChk(t.val(),u,v,w),r=s[p].split(":")[1])}break;case"valRange":if(c.attr("placeholder")&&c.val()==c.attr("placeholder"))q=!1;else{var t=c,x=t.attr("minval")?parseFloat(t.attr("minval")):parseFloat(t.attr("minV")),y=t.attr("maxval")?parseFloat(t.attr("maxval")):parseFloat(t.attr("maxV")),w="";w=t.attr("scope")&&""!=t.attr("scope")?t.attr("scope"):"in",l?n?"":n=k.validators.rangeVChk(t.val(),x,y,w):(q=k.validators.rangeVChk(t.val(),x,y,w),r=s[p].split(":")[1])}break;case"checked":if(l){if("checkbox"==c.attr("type")){for(var e,z=c;"form"!=z.get(0).nodeName.toLowerCase();)z=z.parent();n?"":n=k.validators.checkedChk(c,z.get(0))}else if("radio"==c.attr("type")){for(var e,z=c;"form"!=z.get(0).nodeName.toLowerCase();)z=z.parent();n?"":n=k.validators.checkedRadChk(c,z.get(0))}}else"checkbox"==c.attr("type")?q=k.validators.checkedChk(c,e):"radio"==c.attr("type")&&(q=k.validators.checkedRadChk(c,e)),r=s[p].split(":")[1];break;case"selected":l?n?"":n=k.validators.selectedChk(c):(q=k.validators.selectedChk(c),r=s[p].split(":")[1]);break;case"custom":if(j=c.attr("placeholder")&&c.val()==c.attr("placeholder")?"":c.val(),l){var A=k.errs[s[p].split(":")[1]],B=A(c,!0);B.constructor===Object?B=B.msg:"",B?B=!0:B,n?"":n=B}else if(k.errs[s[p].split(":")[1]])var A=k.errs[s[p].split(":")[1]],B=A(c);q=B&&B.constructor===Object?B.msg:B,r=B}return l?n:q&&!o?(k.heighlightErrOk(r,c,e,"err",f,g,h,i),k.lastErr=c,!1):q&&o?(k.heighlightErrOk(r,c,e,"sMnd",f,g,h,i),k.lastErr=k.lastErr,!0):(k.heighlightErrOk(r,c,e,"ok",f,g,h,i),!0)}},heighlightErrOk:function(c,d,e,f,g,h,i,j){var k,l,m=b,n=null,o=m.errs[c]||c,p=d.attr("id")+"_err",q=d.attr("name")+"_err",r=$(e).find(".erLbl"),s=d.attr("id")||d.attr("name"),t=null,u=$(e).attr("name");if(c&&c.constructor===Object&&!m.errs[c]&&(o=c.msg,c.id?p=q=c.id:"",c.errorField?t=c.errorField:""),o&&o.constructor===Object){var v=o;o=v.msg,v.id?p=q=v.id:"",v.errorField?t=v.errorField:""}for(k=0;k<r.length;k++)r.eq(k).attr("id")!=p&&r.eq(k).attr("id")!=q||(n=r.eq(k));var w,x=null;if(m[u].pExist)for(w=0;w<m[u].pLevel;w++)if(d.parents().eq(w).hasClass(m[u].pExist)){x=d.parents().eq(w);break}if("err"==f){if(x&&x.length>0)x.removeClass(g+" "+h+" "+i),setTimeout(function(){x.addClass(g)},0);else{if(t){var y=$(e).find(t);y.removeClass(g+" "+h+" "+i).addClass(g)}else d.removeClass(g+" "+h+" "+i).addClass(g);n&&(n.removeClass(h+" "+i),!n.hasClass(g)&&j?n.addClass(g):"")}if(n){var z=d.attr("minL")||d.attr("minlength"),A=d.attr("maxL")||d.attr("maxlength"),B=d.attr("minV")||d.attr("minval"),C=d.attr("maxV")||d.attr("maxval");n.attr("id");if(d.val()&&d.val().indexOf("$")>=0)var D=d.val().replace(/\$/g,"$$$");o=o.replace("[MinL]",z).replace("[MaxL]",A).replace("[MinV]",B).replace("[MaxV]",C).replace("[currVal]",D?D.toString().replace(/</g,"&lt;").replace(/>/g,"&gt;"):""),j?n.html(o):"",m.erArry[s]=o,l=d.attr("name")||d.attr("id")||d.get(0).nodeName,m.erArryExt[l]=o}$(e).attr("chk","true"),a||!m.onErr||$.isEmptyObject(m.erArryExt)||m.onErr({err:m.erArryExt,formName:e.name,node:d[0],isSubmit:a})}else if("ok"==f){if(x&&x.length>0)x.removeClass(g+" "+h+" "+i).addClass(h);else if(t){var y=$(e).find(t);y.removeClass(g+" "+h+" "+i).addClass(h)}else d.removeClass(g+" "+h+" "+i).addClass(h);n&&(n.html(""),n.removeClass(g+" "+i)),!a&&m.onValid&&(l=d.attr("name")||d.attr("id")||d.get(0).nodeName,m.erArryExt[l]=null,m.onValid({err:m.erArryExt,formName:e.name,node:d[0],isSubmit:a}))}else if("sMnd"==f){if(x&&x.length>0?x.removeClass(g+" "+h+" "+i).addClass(i):(d.removeClass(g+" "+h+" "+i).addClass(i),n&&(n.removeClass(g+" "+h),!n.hasClass(i)&&j?n.addClass(i):"")),n){var z=d.attr("minL")||d.attr("minlength"),A=d.attr("maxL")||d.attr("maxlength"),B=d.attr("minV")||d.attr("minval"),C=d.attr("maxV")||d.attr("maxval");n.attr("id");o=o.toString().replace("[MinL]",z).replace("[MaxL]",A).replace("[MinV]",B).replace("[MaxV]",C).replace("[currVal]",d.val().replace(/</g,"&lt;").replace(/>/g,"&gt;")),j?n.html(o):"",m.erArry[s]=o}}else"rem"==f&&(x&&x.length>0?x.removeClass(g+" "+i):(d.removeClass(g+" "+i),n&&n.removeClass(g+" "+i)),n&&n.html(""))},validators:{reqChk:function(a,c){var d=/^\s*$/;return b.errs[c]&&(d=new RegExp(b.errs[c].regEx||d)),!!d.test(a)},alphadsChk:function(a,c){var d=/^[a-zA-Z.\s]+$/;return b.errs[c]&&(d=new RegExp(b.errs[c].regEx||d)),""!=a&&(a=$.trim(a),0==a.indexOf(".")||!d.test(a))},alphaChk:function(a,c){var d=/^[a-zA-Z]+$/;return b.errs[c]&&(d=new RegExp(b.errs[c].regEx||d)),""!=a&&!d.test($.trim(a))},numChk:function(a,c){var d=/^[-]?[0-9]+$/;return b.errs[c]&&(d=new RegExp(b.errs[c].regEx||d)),""!=a&&!d.test($.trim(a))},floatChk:function(a,c){var d=/^[-]?[0-9]+(\.[0-9]+)?([eE][+-]?[0-9]+)?$/;return b.errs[c]&&(d=new RegExp(b.errs[c].regEx||d)),""!=a&&!d.test($.trim(a))},alphanumChk:function(a,c){var d=/^[a-zA-Z0-9]+$/;return b.errs[c]&&(d=new RegExp(b.errs[c].regEx||d)),""!=a&&!d.test($.trim(a))},emailChk:function(a,c){var d=/^([0-9a-zA-Z]([\.\w]*[0-9a-zA-Z])*@([0-9a-zA-Z][-\w]*[0-9a-zA-Z]\.)+[a-zA-Z]{2,4})$/;return b.errs[c]&&(d=new RegExp(b.errs[c].regEx||d)),""!=a&&!d.test($.trim(a))},splChk:function(a,c){var d=/^[a-zA-Z\d\s]+$/;return b.errs[c]&&(d=new RegExp(b.errs[c].regEx||d)),""!=a&&!d.test($.trim(a))},rangeChk:function(a,b,c,d){if(c&&""!=c||(c=a.length+1),""==a)return!1;var d=d||"in",a=new String(a);if("in"==d)return(a.length<b||a.length>c)&&b+":"+c;if("out"==d){if(!(a.length>b))return!1;if(a.length<c)return b+":"+c}},rangeVChk:function(a,b,c,d){if(""==a)return!1;var d=d||"in";if("in"==d)return(parseFloat($.trim(a))<b||parseFloat($.trim(a))>c)&&b+":"+c;if("out"==d){if(!(parseFloat($.trim(a))>b))return!1;if(parseFloat($.trim(a))<c)return b+":"+c}},checkedRadChk:function(a,b){var c,d=!1,e=$(b).find("input[type=radio]");for(c=0;c<e.length;c++)e.eq(c).attr("name")==a.attr("name")&&(e.eq(c).is(":checked")?d=!0:"");return!d},checkedChk:function(a,b){var c,d=!1,e=$(b).find("input[type=checkbox]");for(c=0;c<e.length;c++)e.eq(c).attr("name")==a.attr("name")&&(e.eq(c).is(":checked")?d=!0:"");return!d},checkedChkSrv:function(a){return null==a||""==a},selectedChk:function(a){return 0==a.get(0).selectedIndex},selectedChkSrv:function(a,b){return a==b}},getFrmElms:function(a,b){var c,d=[],e=a.get(0).elements;for(c=0;c<e.length;c++){var f=e[c].nodeName.toLowerCase();b?"input"!=f&&"select"!=f&&"textarea"!=f||"submit"==$(e[c]).attr("type")||""==$(e[c]).attr("placeholder")||d.push($(e[c])):"input"!=f&&"select"!=f&&"textarea"!=f||"submit"==$(e[c]).attr("type")||!$(e[c]).attr("rel")||""==$(e[c]).attr("rel")||d.push($(e[c]))}return d},getSbtBtns:function(a,b,c){var d,e,f=[],g=a.find("input[type=submit], button[type=submit]");if(g.length>0&&f.push(g),b)if(b.constructor===Array)for(d=0;d<b.length;d++)f.push($("#"+b[d])),e+="#"+b[d]+",";else f.push($("#"+b)),e="#"+b;return c?[f,e.replace(/,+$/,"")]:f},showHideElement:function(a,c){var d,e=b,a=a||null;if(a.length)if(a.constructor===Array)for(var d=0;d<a.length;d++)"string"==typeof a[0]?e.processAltRel($("#"+a[d]),c):e.processAltRel(a[d],c);else a instanceof Object?e.processAltRel(a,c):e.processAltRel($("#"+a),c)},hideElement:function(a){b.showHideElement(a,"h")},showElement:function(a){b.showHideElement(a,"s")},processAltRel:function(a,b){a="String"==typeof a?$("#"+a):a,"s"==b?a.attr("rel",a.attr("altrel")):"h"==b&&(a.attr("altrel")?"":a.attr("altrel",a.attr("rel")),a.removeAttr("rel"))},supportPlaceholder:function(){var a=document.createElement("input");return"placeholder"in a},fillVal:function(a){if(a.constructor===Object)for(var b in a)$("#"+b).val(a[b]).css({color:""})},getErrorStatus:function(a){var c=b;return c.erArryExt}};return{validate:b.validate,showElement:b.showElement,hideElement:b.hideElement,isValid:b.isValid,checkValids:b.checkValids,fillVal:b.fillVal,setDefaultValues:b.setDefaultValues,sanitizeDefaultValues:b.sanitizeDefaultValues,isValidSrv:b.isValidSrv,validators:b.validators,getErrorStatus:b.getErrorStatus}}});