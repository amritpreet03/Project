define(function(){"use strict";function a(a){return/^true$/gi.test(a)||!/^false$/gi.test(a)&&a}var b=function(a,b,c,d){if(d.length){var e,f=b.height(),g=b.scrollTop(),h=f+g,i=d.position().top+b.scrollTop(),j=i+d.outerHeight();return j>=h?(e=j-f>0?j-f:0,b.scrollTop(e)):i<b.scrollTop()&&(e=i,b.scrollTop(e)),e}},c=function(b,c){for(var d in b){var e=!1,f=d.toLowerCase();c[f]?e=f:void 0!==c[d]&&null!==c[d]&&(e=d),e&&(b[d]=a(c[e]))}return b},d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};navigator.userAgent.match(/(iPhone|iPod|iPad)/i)&&$("body").css({cursor:"pointer"}),window.droope=function(a,b,c){var d=$("#"+a.id);if(!d.data("droope")){var e=new f(a,b,c);return d.data("droope",e),e}d.destroy&&d.destroy()};var e=0,f=function g(a,f,h){function i(){}function j(a){var b=$(a.target).parents(".ddwn");if(!b.length&&Boolean(b.attr("searchDisabled"))!==!0){var c=$(".ddwn");c.find(".DDwrap").removeClass("brBotN"),c.find(".drop").hide()}}function k(a){$(document).on("keydown",p.disb_Scroll_handler)}function l(a){$(document).off("keydown")}function m(a){return a>r?r+=5:void(r+=1)}function n(a,b){if(""!==p.inpElm.val()&&r>q){if(b>r)return r-=5;r-=1}}a.maxSelection=a.maxSelection||a.maxTagsCount;var o={maxHeight:300,maxTagsCount:1/0,maxSelection:1/0,searchBox:!0,tagsSorting:!0,tags:!0,tagInSepContainer:!1,checkBox:!1,appendTags:!1,clearTagId:!1,prefillData:[],onDeselect:!1,sortPrefix:!1,tagwithOptGroup:!1,clearAllInside:!1,parentChkBox:!1,allChk:!1,allChecked:!1,layerOpenStatus:!1,disableTag:[],title:[],tagTitle:!1,Tagfocus:0,TagCnt:0,Allflg:"",curActElm:"",liCntrFx:[],preventClickFor:[],liCntr:[],optgrpNameRef:[],hidValue:[],parentRefData:{},optgrpObject:{},showSelText:!1,preserveInputVal:!1,onClickReq:i,onClickAll:i,onChange:i,selectedValues:{},selectedCounter:!0,preventClose:!1,defaultOpen:!1,onTagClick:i,onTagCreate:i,isReset:!0,onClearTag:[],drpLyrWth:!1,onBlur:i,blurDelay:!1,isSearch:!0,removeHiddenVal:!1,preserveText:!1,pKey:h,id:"",preText:"You have selected",postText:"item(s)",selectOnBlur:!1,toggleDropLayer:!0,scrollToTop:!1,isFirstValueHighlight:!0,returnFocus:!0,onChangePrevent_onInit:!1,onError:i},p=$.extend(this,c(o,a));p.obj=a;var q=30,r=p.obj.postPlaceholder?p.obj.postPlaceholder.width:30;p.rootCont=$("#"+p.id),p.inpElm=p.rootCont.find(".srchTxt"),p.isReadOnly=p.inpElm.is("[readonly]"),p.dataObj=a.data||(a.id&&a.id[p.id]?a.id[p.id][0]:""),p.prefillData=p.prefillData||(p.obj.id[p.id]?p.obj.id[p.id][1]:[]),"string"==typeof p.prefillData&&(p.prefillData=p.prefillData.split(",")),p.pKey?(p.checkBox||(droope.Ary[p.id]={}),droope.Ary[p.id]||(droope.Ary[p.id]={}),droope.Ary[p.id][p.pKey]=p.dataObj,p.Ary=droope.Ary[p.id]):(p.Ary={},p.Ary.A=p.dataObj),g.lastRef.iseventBindOnDocument||($(document).on("click touchstart",function(a){setTimeout(function(){j(a)},100)}),g.lastRef.iseventBindOnDocument=!0);var s=function(a){return a.replace(/>/g,"&gt;").replace(/</g,"&lt;")},t=function(a){if(a.indexOf("<b>")!=-1){a=a.split("<b>");var b=a[1].split("</b>"),c=[a[0],b[0],b[1]],d=[];for(var e in c)d.push(s(c[e]));return d[0]+"<b>"+d[1]+"</b>"+d[2]}return s(a)},u=function(){p.returnFocus&&p.inpElm.focus()};p.replaceTag=function(a){return a.toString().indexOf("<")!=-1?t(a):a},p.setLi=function(a){var b=this;if($("#ul_"+a).find("li").length<b.liCntr){var c=b.appendData(b.Ary,"","",!0);b.dpLyr.find("ul").html(c[0]),b.liCntr=b.liCntrFx}},p.obj.resetPrefillValues?p.ChkBoxContr={}:p.ChkBoxContr?"":p.ChkBoxContr={};for(var v in p.clearTagId)for(var w in p.clearTagId[v])p.onClearTag[v]=p.clearTagId[v][w];p.Fn={preserveEventafterClone:function(b,c){var d;p.id;d=p.tagInSepContainer?$("#"+p.tagInSepContainer).find('[data-id="'+b+'"]'):p.rootCont.find(".DDsearch").find('[data-id="'+b+'"]'),d.on("click",".dCross",function(d){p.removeTag(b,$(this).find(".tagTxt").text(),c),p.max_height(),c?p.onTagClick(a,p.TagCnt):"",p.setInputText(),"block"==p.dpLyr.css("display")?u():""})},keyUpEv:function(a){var b,c=$(this).data("id"),d=p.rootCont.width()-15,e=(c.split("_")[1],a.keyCode||a.which),f=$(this).val().replace(/\b/g,"");if(13==e&&p.curActElm&&p.curActElm.length&&!p.curActElm.hasClass("noData")&&p.curActElm.hasClass("active")){var g=p.curActElm.children("a");if(p.checkBox){var h=g.data("id")+"_"+p.Escp(p.curActElm.attr("bindto"));g.hasClass("chkd")?p.removeTag("tg_"+h,g.html(),!0):p.CreateTags(g,h,"",p.tags)}else p.SingleSelection(g.text(),g.data("id").split("_")),p.hideDD()}8==e&&p.checkBox&&!p.tagInSepContainer&&p.tags!==!1&&(b=f?n(c,d)+"px":""!=p.inpHid.val()?r+"px":"",p.inpElm.css({width:b})),p.isReadOnly||9==e||13==e||18==e||32==e||37==e||38==e||39==e||40==e||16==e||(p.Fn.initSearch(f,c,e),"none"==p.dpLyr.css("display")&&p.dpLyr.show()),p.removeHiddenVal&&(f||p.inpHid.attr("value",""))},initSearch:function(a,b,c){var e="",f=0;b=b.split("_")[1];var g=p.Ary;if(a){a=a.replace(/&amp;/gi,"&").replace(/[\s]+/g," ").replace(/^\s/,"");for(var h in g)for(var i in g[h])if("object"===d(g[h][i])){var j,k="";j=g[h][i];for(var l in j)k+=p.searchData(j[l],a,b,b+"_"+l+"_"+p.eUnderScore(i),p.Escp(h));k&&(e+='<li class="optgroup">'+p.eUnderScore(i)+"</li>"+k,f++)}else p.rootCont.find(".cross").show(),e+=p.searchData(g[h][i],a,b,b+"_"+p.eUnderScore(i),p.Escp(h)),f++}else p.rootCont.find(".cross").show(),e=p.appendData(p.Ary,"","",c)[0],f=p.liCntrFx;if(!e){var m=p.obj.noDataTxt?p.obj.noDataTxt:"No data found in search";e='<li class="noData">'+m+"</li>",f++}p.dpLyr.find("ul").html(e),p.liCntr=f,p.max_height(),p.firstHighlight()}},p.init=function(a){function b(a){return function(){var b=$(this).attr("id"),c=a[b],d=c.id;if(d)for(var e in d){d[e];p.checkBox?p.removeAllTags():(p.inpElm.val(""),p.inpHid.data("optGroupKey","")),p.Allflg="",p.hideDD()}c.clrCalbackfun&&p.onClearTag[b](p.obj,0,$(this))}}var c,d=p.id;if(p.clearAllInside){var e="Clear All";for(var f in p.clearAllInside)e=p.clearAllInside[f];c=$("<div>").addClass("DDclearAll").attr({id:"clrAll_"+d}).html(e)}var g=p.inpElm;if(g.val(""),!p.dpLyr||!p.dpLyr.length){var h=g.attr("name");g.data({name:h});var i=(p.rootCont.find(".arw").addClass("DDarwDwn"),p.rootCont.find(".DDsearch"));p.checkBox||p.rootCont.addClass("singleSelect"),g.data({id:"inp_"+d,placeholder:g.attr("placeholder")}).attr({name:"",autocomplete:"off"}),p.isSearch||g.attr("readonly","readonly"),p.rootCont.find(".frst").css({"float":"none"}),$("#hid_"+d).length?p.inpHid=$("#hid_"+d):(p.inpHid=$("<input>").attr({type:"hidden",id:"hid_"+d,name:h}),i.append(p.inpHid));var j=$("<div>"),k=$("<div>"),l=$("<ul>"),m=p.rootCont,n=p.checkBox?"ChkboxEnb":"";p.dpLyr=j,k.addClass("nScroll").attr("id","ul_"+d),j.addClass("drop").attr("id","dp_"+d),l.addClass(n),k.append(l),c?j.append(c):"",j.append(k),m.append(j),p.rootCont.on("click",".DDinputWrap, .DDsearch, .arw",function(a){u()}).on("mouseenter",function(){p.layerOpenStatus=p.searchBox!==!1}).on("mouseleave",function(){p.layerOpenStatus=!1})}if(p.bindEvents(),p.layerOpenStatus=p.searchBox!==!1,p.fillData(),p.clearTagId)for(var f in p.clearTagId)$("#"+f).on("click",b(p.clearTagId))},p.blurEv=function(a){var b=(p.id,p.selectOnBlur);if(!p.tagInSepContainer&&p.checkBox?p.rootCont.find(".tagit").last().removeClass("TagSelected"):"",p.isReadOnly&&l(a),p.layerOpenStatus||p.hideDD(),!p.checkBox){var c,d,e=p.inpHid,f=p.inpElm,g=p.uEscp(e.attr("opt")),h=p.Ary.A,i=p.getKeyFromVal(p.Ary.A,f.val()),j=e.val(),j=p.sortPrefix?p.sortPrefix+j:j;b?(c=i.retKey,d=i.parentKey?g?h[g][j]:h?h[i.parentKey][c]?h[i.parentKey][c]:h[i.parentKey][j]:"":g?h[g][j]:h?h[c]?h[c]:h[j]:""):d=i.parentKey?g?h[g][j]:h?h[i.parentKey][j]:"":g?h[g][j]:h?h[j]:"",f.val()?d&&(p.preserveInputVal&&(d=$(this).val(),e.val("")),f.val(d),p.blurClearTimeoutId=setTimeout(function(){if(b){var a=c?c:p.getKeyFromVal(p.Ary.A,d).retKey,f=a.replace(p.sortPrefix,"");e.val(f),p.onBlur(f)}},p.blurDelay||0)):(e.val(""),"none"==p.dpLyr.css("display")&&p.onChangeHandler(""),p.onDeselect&&p.onDeselect())}},p.getKeyFromVal=function(a,b,c){var e=a,f={};for(var g in e){if("object"==d(e[g]))return p.getKeyFromVal(e[g],b,g);if($.trim(e[g].toString().toLowerCase())==$.trim(b.toLowerCase())){f.retKey=g;break}}return c&&(f.parentKey=c),f},p.focusEv=function(a){p.layerOpenStatus=p.searchBox!==!1,p.inpt=$(this);var b=$(this).data("id");b.split("_")[1];p.DDSearch=$(this).parent(".DDSearch"),p.showDD(),p.isReadOnly&&k(a),setTimeout(function(){e=1},200)},p.keyDownEv=function(a,c){var d,e=p.id,f=a.keyCode||a.which,g=p.rootCont.width()-15,h=c.val().replace(/\b/g,""),i=p.dpLyr.css("display");if(13!=f&&38!=f||a.preventDefault(),13==f&&"none"==i&&!p.checkBox&&p.obj.form&&p.obj.form[0].submit(),9==f||27==f?p.hideDD():"",(f>=97&&f<=122||f>=65&&f<=90||f>=48&&f<=57)&&!p.tagInSepContainer&&p.checkBox&&p.tags!==!1&&(d=m(g),p.inpElm.css({width:d+"px"})),!h&&p.checkBox){var j=p.rootCont.find(".tagit").last(),k=j.data("id");p.TagCnt>0&&8==a.keyCode&&!p.tagInSepContainer&&k&&k.length>0?p.Tagfocus?(p.removeTag(k,j.children(".tagTxt").html(),!0),p.Tagfocus=0):(p.rootCont.find(".DDsearch").find('[data-id="'+k+'"]').addClass("TagSelected"),p.Tagfocus=1):k&&(p.rootCont.find(".DDsearch").find('[data-id="'+k+'"]').removeClass("TagSelected"),p.Tagfocus=0)}var l=$("#ul_"+e),n=l.find("ul"),o=n.find("li").first();if(p.curActElm.length||(p.curActElm=o),40==f)if("none"==i)p.hideDD(),p.showDD();else{var q,r=p.curActElm.next();r.length&&!r.hasClass("noData")&&(q=r.hasClass("optgroup")?r.next():r,p.curActElm.removeClass("active"),q.addClass("active"),p.curActElm=q,b(p.dpLyr,n.parent(),o,p.curActElm))}else if(38==f){var s,t=p.curActElm.prev();t.length&&(s=t.hasClass("optgroup")?t.prev():t,s.length&&(p.curActElm.removeClass("active"),s.addClass("active"),p.curActElm=s,b(p.dpLyr,n.parent(),o,p.curActElm)))}},p.fillDatainDropdwonLayer=function(a,b,c,d,e){p.inpElm;p.checkBox&&p.inpHid.attr({value:""});var f=p.rootCont,g=f.find(".drop");p.searchBox===!1?(f.attr("searchDisabled",!0).find(".DDwrap").hide(),g.css({position:"static"})):g.css({borderTop:0}),p.defaultOpen&&setTimeout(function(){p.showDD()},0),$("#ul_"+a).find("ul").html(b),b="",p.searchBox===!1?p.showDD():"",(p.allChk||p.parentChkBox)&&p.chkForParent(p.optgrpObject,p.DATA,a)},p.liMousehover=function(){p.id;p.dpLyr.on("mouseover","li.pickVal",function(){p.curActElm.length&&(p.firstHighlight(),p.curActElm.removeClass("active")),$(this).addClass("active"),p.curActElm=$(this)}).on("mouseout","a",function(){$(this).removeClass("active")})},p.max_height=function(){if(p.maxHeight=parseInt(p.maxHeight),p.maxHeight){for(var a=p.id,b=$("#ul_"+a),c=0,d=$("#ul_"+a).find(" ul li").first();d.length&&p.maxHeight>=c;)c+=d.outerHeight(),d=d.next();p.maxHeight<c?b.css({height:p.maxHeight+"px"}):b.css({height:c+"px",width:"100%"}),b.length&&b[0].csb&&b[0].csb.reset()}},p.PickValuesFromDD=function(){var b;p.id;p.dpLyr.on("click",".pickVal a",function(c){if(p.checkBox){var d=0,e=$(this),f=e.data("id");if(p.parentChkBox)var g=$(this).data("id").split("_"),h=g[g.length-1];if($(this).hasClass("chkd")&&(d=1),b=e.html(),f.split("_")[1]==p.eUnderScore(p.otherLabId))1==d?p.onClickReq(a,p.otherLabId,"unChecked"):p.onClickReq(a,p.otherLabId,"checked"),p.hideDD();else{var g=$(this).data("id").split("_");if(p.parentChkBox)var h=p.dUnderScore(p.uEscp(g[g.length-1])),i=p.uEscp(g[g.length-2]);else var h="All",i=p.uEscp(g[g.length-1]);if(1==d){var j=f;if($(this).parent().attr("bindto")&&(j=f+"_"+p.Escp($(this).parent().attr("bindto"))),p.removeTag("tg_"+j,b,!0),p.parentChkBox||p.allChk){var k=p.optgrpObject[h].checked.indexOf(i);k>-1&&p.optgrpObject[h].checked.splice(k,1),p.optgrpObject[h].unchecked.push(i),p.chkForParent(p.optgrpObject,"",f)}}else{var l=$(this).parent().attr("bindto");if(l?f=f+"_"+p.Escp(l):"",p.CreateTags(e,f,"",p.tags),p.parentChkBox||p.allChk){var k=p.optgrpObject[h].unchecked.indexOf(i);k>-1&&p.optgrpObject[h].unchecked.splice(k,1),p.optgrpObject[h].checked.push(i),p.chkForParent(p.optgrpObject,"",f)}}p.searchBox!==!1&&p.allChk!==!0?setTimeout(function(){u()},100):""}}else p.SingleSelection($(this).text(),$(this).data("id").split("_"))})},p.SingleSelection=function(b,c){var d=(c[0],c[2]?c[2]:"");""===c[1]&&(b=""),p.inpElm&&p.inpElm.val(b.toString().replace(/^(\s)+|(\s)+$/g,"")),p.rootCont.find(".cross").show();var e=p.dUnderScore(p.uEscp(c[1])).replace(p.sortPrefix,"");p.inpHid.val();p.inpHid.attr({value:e}).data("optGroupKey",d),p.layerOpenStatus&&p.hideDD(),p.onClickReq(a,e),p.onChangeHandler(e,b)},p.CreateTags=function(b,c,d,e){var f=(p.id,c.split("_")[1]);if(e="-1"==$.inArray(f,p.preventClickFor)&&0!=e,p.hidValue.length<p.maxSelection){var g,h=p.uEscp(c).split("_"),i=c.split("_"),j=3==i.length?i[0]+"_"+i[1]:i[0]+"_"+i[1]+"_"+i[2];if("string"!=typeof b?(g=b.text(),b.addClass("chkd")):g=b,p.TagCnt++,p.selectedCounter&&(p.obj.postPlaceholder&&p.obj.postPlaceholder.text?p.inpElm.attr("placeholder",p.obj.postPlaceholder.text):p.inpElm.attr("placeholder","")),e!==!1){g=g.replace(/(<([^>]+)>)/gi,"").replace(/&amp;/gi,"&"),p.tagwithOptGroup?g="<b>"+h[2].replace("xSlashX","/").replace(/SxP/gi," ")+"</b>("+g+")":"";var k,l=$("<li>").append('<span class="tagTxt">'+g+"</span>"),m="tg_"+c;p.tagTitle&&l.attr("title",g);var n=p.tagInSepContainer;if(n||e===!1){var o=l.append($("<a>").addClass("dCross")).addClass("tagit").attr({"data-id":m}),q=$("#"+n)[0];if(p.appendTags){var s=q.children[d];s?s.parentNode.insertBefore(o[0],s):$("#"+n).append(o)}else e===!1?"":q.insertBefore(o[0],q.firstChild);k=m+" a.dCross"}else p.appendTags?p.rootCont.find(".DDsearch li").last().before(l.append($("<span>").html("close").addClass("dCross icon")).addClass("tagit").attr({"data-id":m})):p.rootCont.find(".DDsearch").prepend(l.append($("<span>").html("close").addClass("dCross icon")).addClass("tagit").attr({"data-id":m})),p.inpElm.css({width:r+"px"}),k=m+" span.dCross";p.Fn.preserveEventafterClone(m,!0)}$("#ul_"+p.id).find('[data-id="'+j+'"]').addClass("chkd"),p.setValueInHiddenField(h[1],g),p.ChkBoxContr[h[1]]=c,p.onClickReq(a,p.dUnderScore(p.uEscp(h[1])),"Checked",$('li[data-id="tg'+c+'"]'),p.TagCnt),p.setInputText()}else p.onError({msg:"Max "+p.maxSelection+" selections are allowed",type:"maxSelection_Reached"}),p.onTagCreate("Maximum Tags Created");p.tags&&!p.tagInSepContainer&&(p.inpElm.val(""),p.setLi(p.id),p.max_height())},p.disb_Scroll_handler=function(a){var b=a.keyCode;if(40===b||38===b||32===b)return a.preventDefault(),!1},p.setValueInHiddenField=function(a,b,c){var d=p.id,e={};if(e[a]=b,$.extend(p.selectedValues,e),a&&b){"all"==b.toLowerCase()&&(p.Allflg="all"),a=p.dUnderScore(p.uEscp(a)).replace(p.sortPrefix,"");var f=p.inpHid.val();f?(p.hidValue.push(a),p.inpHid.val(JSON.stringify(p.hidValue))):(p.hidValue.push(a),p.inpHid.val(JSON.stringify(p.hidValue)),$("#clrAll_"+d).show(),p.tagInSepContainer?$("#"+p.tagInSepContainer).show():p.rootCont.find("li.frst").css({"float":"left"})),p.onTagCreate()}else c!==!1&&(p.inpElm.val(""),p.inpHid.val(""));p.onChangeHandler(p.hidValue,p.selectedValues)},p.init(),p.PickValuesFromDD(),p.liMousehover(),p.parentChkBox&&p.clickParent(),p.allChk&&p.clickMain(),this.allChecked&&$('li.optgroup[data-id="opt_all"]').click(),p.onChangePrevent_onInit=!1};f.prototype=function(a){var b,c=function(a){var b=this,c=b.id,d=b.rootCont;d.addClass("open"),d.find(".DDwrap").addClass("brBotN"),d.find(".drop").show(),b.scrollToTop&&($("#ul_"+c)[0].scrollTop=0),b.drpLyrWth&&b.dpLyr.css({width:b.drpLyrWth}),b.max_height(),b.checkBox||b.firstHighlight()},f=function(){var a=this;a.inpElm.on("focus click",a.focusEv).on("keydown",function(b){a.keyDownEv(b,$(this))}).on("keyup",a.Fn.keyUpEv).on("blur",a.blurEv)},g=function(){var a=this;$("#"+a.id).addClass("disable"),a.inpElm.attr("readonly","readonly"),a.inpElm.off("click focus keydown keyup blur")},h=function(){var a=this,b=$("#"+a.id);b.hasClass("disable")&&(b.removeClass("disable"),a.inpElm.removeAttr("readonly"),a.bindEvents())},k=function(a){var b=this,c=(b.id,{});if(b.checkBox)if(a.length&&"object"===("undefined"==typeof a?"undefined":d(a)))for(var e in a)c[a[e]]="1";else c[a]="1";else a.length&&(c[a.toString()]="1");return c},l=function(){var a=this,b=a.id;for(var c in a.ChkBoxContr){var d,e=a.ChkBoxContr[c],f=e.split("_");if(3==f.length?d=f[0]+"_"+f[1]:4==f.length&&(d=f[0]+"_"+f[1]+"_"+f[2]),$("#ul_"+b).find('[data-id="'+d+'"]').removeClass("chkd"),a.tagInSepContainer?$("#"+a.tagInSepContainer).find('[data-id="tg_'+e+'"]').remove():a.rootCont.find(".DDsearch").find('[data-id="tg_'+e+'"]').remove(),a.parentChkBox||a.allChk){if(a.parentChkBox)var g=a.dUnderScore(a.uEscp(f[2]));else var g="All";var h=f[1],i=a.optgrpObject[g].checked.indexOf(h);i>-1&&a.optgrpObject[g].checked.splice(i,1),a.optgrpObject[g].unchecked.push(h)}}a.parentChkBox&&$("#ul_"+b).find('li a[data-id="'+b+'"]').removeClass("chkd"),a.allChk&&($("#ul_"+b).find('li[data-id="opt_all"]').find("a").removeClass("chkd"),a.onClickAll("unchecked")),a.resetInpWidth(b),a.ChkBoxContr={},a.inpHid.val(""),a.hidValue=[],a.TagCnt=0,a.setPlaceHolderAttribute()},m=function(){var a=this,b=(a.id,a.rootCont);a.dpLyr.remove(),a.inpHid.remove(),b.find(".DDsearch .tagit").remove(),a.inpElm.val("").attr({placeholder:a.inpElm.data("placeholder"),name:a.inpElm.data("name")}),a.inpElm.removeAttr("autocomplete style"),a.inpElm.off("focus keydown keyup blur"),b.find(".DDwrap").show(),b.data("droope",null)},n=function(a,b,c,d){var e=this,f=e.id,g=a.replace("tg_",""),h=e.uEscp(g).split("_"),i=$("#hid_"+f).val();i=i?JSON.parse(i):"";var j=4==h.length?h[0]+"_"+h[1]+"_"+h[2]:h[0]+"_"+h[1];if($.inArray(e.dUnderScore(e.uEscp(h[1])),i)!=-1){if($("#ul_"+f).find('[data-id="'+e.Escp(j)+'"]').removeClass("chkd"),e.parentChkBox){var k=j.split("_");k=k[k.length-1];for(key in e.parentRefData[k])$(e.parentRefData[k][key]).find("a").hasClass("chkd")||($("#ul_"+f).find('li[data-id="opt_'+k+'"]').find("a").removeClass("chkd"),$("#ul_"+f).find('li[data-id="opt_all"]').find("a").hasClass("chkd")&&($("#ul_"+f).find('li[data-id="opt_all"]').find("a").removeClass("chkd"),e.onClickAll("unchecked")))}d?$("#"+d).remove():e.tagInSepContainer?$("#"+e.tagInSepContainer).find('[data-id="'+a+'"]').remove():e.rootCont.find(".DDsearch").find('[data-id="'+a+'"]').remove(),e.emptyHidField(g.split("_")[1],f,b),e.TagCnt--,e.TagCnt||e.setPlaceHolderAttribute();for(var l in e.ChkBoxContr)e.ChkBoxContr[l]==g&&delete e.ChkBoxContr[l];c?e.onClickReq(e.obj,e.dUnderScore(e.uEscp(h[1])),"Unchecked","",e.TagCnt):"",e.setInputText()}},o=function(){var a=[],b=this,c=b.id,d=b.prefillDataFormation(b.prefillData);a[c]=d;b.inpHid.val()&&b.removeAllTags(),b.NLi=b.appendData(b.Ary,a,d),b.fillDatainDropdwonLayer(c,b.NLi[0],0,b.NLi[3],b.NLi[4]),b.liCntrFx=b.liCntr=b.NLi[1],b.createTags_ifPrefillData(b.NLi[2])},p=function(a,c,e,f){var g,h,i="",j=this,k=j.id,l=[],m="",n=0,o=0;j.allChk&&(i+=j.createParLi("all","All","0",!0));for(var p in a){h=p;for(var q in a[p]){var r=q.replace(j.sortPrefix,""),s=j.eUnderScore(j.Escp(r));if("object"===d(a[p][q])){var t=j.parentChkBox;i+=j.createParLi(s,q,k,t,h);var u=[];n++;var v=[];j.optgrpObject[q]={},j.optgrpObject[q].checked=v,j.optgrpObject[q].unchecked=u;for(var w in a[p][q]){e&&void 0!=e[w]?v.push(w):u.push(w),j.optgrpNameRef[w]={pName:q,text:a[p][q][w]};var x=j.Escp(w).replace(j.sortPrefix,"");if(c[k])if(c[k][x]){var y;if(parseInt(c[k][x])?y=x:"",y===x){j.inpVal=w,m=a[p][q][w];var z=p?k+"_"+x+"_"+s+"_"+p:k+"_"+x+"_"+s,A=[m,z,k,x];l[o++]=A,n++,j.tags&&j.SingleSelection(m,[k,w]),i+=j.createLi({raw_id:x,id:k+"_"+x+"_"+s,txt:a[p][q][w],bnd:p,chkd:"",dis:B,title:b}),g=s}}else{e.toString()===x&&(j.inpVal=w,m=a[p][q][w],g=s,j.tags&&j.SingleSelection(m,[k,w])),n++;var C=j.selCheckBox(k,s,p,x);i+=j.createLi({raw_id:x,id:k+"_"+x+"_"+s,txt:a[p][q][w],bnd:p,chkd:C,dis:B,title:b})}else{e===w&&(j.inpVal=w,m=a[p][q][w]);var D=j.selCheckBox(k,s,p,x);i+=j.createLi({raw_id:x,id:k+"_"+x+"_"+s,txt:a[p][q][w],bnd:p,chkd:D,dis:B,title:b}),n++}}}else{if(j.optgrpNameRef[q]={text:a[p][q]},j.allChk){var u=[],v=[];j.optgrpObject.All={},j.optgrpObject.All.checked=v,j.optgrpObject.All.unchecked=u;for(var w in a[p])void 0!=e[w]?v.push(w):u.push(w)}if(j.optgrpNameRef[q]={text:a[p][q]},j.checkBox){var E="";if(c&&!$.isEmptyObject(c[k])&&(c[k][r]?E=r:""),E==r||E&&j.sortPrefix&&!j.sortPrefix.match(q)){var F=[a[p][q],k+"_"+s+"_"+p,k,q];l[o++]=F,i+=j.createLi({raw_id:s,id:k+"_"+s,txt:a[p][q],bnd:p,chkd:"",dis:B,title:b}),n++}else{var G=j.selCheckBox(k,s,p);i+=j.createLi({raw_id:s,id:k+"_"+s,txt:a[p][q],bnd:p,chkd:G,dis:B,title:b}),n++}}else{var E="";c&&!$.isEmptyObject(c[k])&&(c[k][r]?E=r:""),E==r||E&&j.sortPrefix&&!j.sortPrefix.match(q)?(i+=j.createLi({raw_id:s,id:k+"_"+s,txt:a[p][q],bnd:"",chkd:"",dis:B,title:b}),j.inpVal=r,m=a[p][q],n++,f?"":j.SingleSelection(a[p][q],[k,r])):(i+=j.createLi({raw_id:s,id:k+"_"+s,txt:a[p][q],bnd:"",chkd:"",dis:B,title:b}),n++)}}}}if(j.checkBox&&j.tagsSorting===!1){var H=[],I=0;for(var J in e)for(var K in l)l[K][3]==J&&(H[I++]=l[K]);l=H}return $.extend(j.Ary[h],a[h]),[i,n,l,m,g]},q=function(a,b,c){var d=0,e=0,c=c.split("_")[0];for(key in a)d++,0==a[key].unchecked.length?($('li[data-id="opt_'+this.eUnderScore(this.Escp(key))+'"]').find("a").addClass("chkd"),e++):($("#ul_"+c).find('li[data-id="opt_'+this.eUnderScore(this.Escp(key))+'"]').find("a").removeClass("chkd"),$("#ul_"+c).find('li[data-id="opt_all"]').find("a").hasClass("chkd")&&($("#ul_"+c).find('li[data-id="opt_all"]').find("a").removeClass("chkd"),this.onClickAll("unchecked")));d==e&&($("#ul_"+c).find('li[data-id="opt_all"]').find("a").addClass("chkd"),this.onClickAll("checked"))},r=function(a){return a?a.replace(/\s/g,"SxP"):""},s=function(a){return!!a&&a.replace(/SxP/g," ")},t=function(a){return a?a.replace(/\_/g,"undrxxscr"):""},u=function(a){return a?a.replace(/undrxxscr/gi,"_"):""},v=function(){var a=this,b=a.id;$("#ul_"+b).on("click","li.optgroup",function(){var a=this,b=$(this).nextUntil("li.optgroup"),c=b.length;if($(this).children("a").hasClass("chkd")){for(i=0;i<=c;i++)$(b).eq(i).find("a").hasClass("chkd")&&$(b).eq(i).find("a").click();$(a).children("a").removeClass("chkd")}else{for(i=0;i<=c;i++)$(b).eq(i).find("a").hasClass("chkd")||$(b).eq(i).find("a").click();$(a).children("a").addClass("chkd")}})},w=function(){var a=this,b=a.id;$("#ul_"+b).on("click",'li.optgroup[data-id="opt_all"]',function(b){b.stopImmediatePropagation();var c=this,d=$(this).siblings("li.optgroup"),e=d.length;if($(this).children("a").hasClass("chkd")){for(j=0;j<=e;j++)$(d).eq(j).find("a").hasClass("chkd")||$(d).eq(j).click();$(c).children("a").addClass("chkd")}else{for(j=0;j<=e;j++)$(d).eq(j).find("a").hasClass("chkd")&&$(d).eq(j).click();$(c).children("a").removeClass("chkd"),a.onClickAll("unchecked")}})},x=function(a,b,c,d,e){var f="",g=this,a=a.toString(),h=a.toLowerCase().indexOf(b.toLowerCase()),i=a.toLowerCase(),j=b.toLowerCase(),k=!(i.indexOf(" "+j)<0)&&i.indexOf(" "+j),l=!(i.indexOf("("+j)<0)&&i.indexOf("("+j),m=!(i.indexOf("/"+j)<0)&&i.indexOf("/"+j);if(h>=0&&(k||l||m)||0===h){h&&(k?h=k+1:l?h=l+1:m&&(h=m+1));var n=a.substr(0,h),o="<b>"+a.substr(h,b.length)+"</b>",p=a.substr(h+b.length,a.length),q=g.Escp(d).replace(g.sortPrefix,"");f=g.selChkBox(q+"_"+e,c)?g.createLi({raw_id:q,id:q,txt:n+o+p,bnd:e,chkd:"chkd"}):g.createLi({raw_id:q,id:q,txt:n+o+p,bnd:e,chkd:""})}return f},y=function(a,b){var c=0,d=this;for(var e in d.ChkBoxContr)a==d.ChkBoxContr[e]&&(c=1);return!!c},z=function(a,b,c,d){var e=0;for(var f in this.ChkBoxContr){e=1;break}if(e)return d?this.selChkBox(a+"_"+d+"_"+b+"_"+c,a)?"chkd":"":this.selChkBox(a+"_"+b+"_"+c,a)?"chkd":""},A=function(a,b,c,d,e){e=e?'bindTo="'+e+'"':"",d=d?'class="'+d+'"':"";var f="";return f=d?'<a href="javascript:;" data-id='+c+">"+b+"</a>":b,'<li class="optgroup" '+e+" data-id=opt_"+a+">"+f+"</li>"},B=!1,C=function(a){var b=this,c=a.id,d=a.txt,e=a.bnd,f=a.chkd,g=(a.dis,a.title||""),h=a.raw_id;e=e?'bindTo="'+e+'"':"";var i=b.disableTag.length&&b.disableTag.indexOf(h)!=-1?"disable":"";return f=f?'class="'+f+'"':"",'<li title="'+g+'" class="pickVal '+i+'" '+e+' ><a href="javascript:;" '+f+' data-id="'+c+'" > '+this.replaceTag(d)+' <i class="icon"></i> </a></li>'},D=function(a){$("#clrAll_"+a).hide(),this.inpElm.css({width:""}),this.rootCont.find("li.frst").css({"float":"none"})},E=function(){var a,b=this,c=b.id,d=$("#ul_"+c),e=d.find("ul");b.curActElm&&b.curActElm.removeClass("active"),b.curActElm=b.isFirstValueHighlight?e.find("li").first():b.curActElm;var f=b.Escp(b.inpHid.attr("value"));f&&!b.checkBox?(a=b.inpHid.data("optGroupKey")?c+"_"+f+"_"+b.inpHid.data("optGroupKey"):c+"_"+f,b.curActElm=e.find('[data-id="'+a+'"]').parent().addClass("active")):b.curActElm&&b.curActElm.addClass("active")},F=function(a,b,c){var d=this;c&&"all"==c.toLowerCase()?d.Allflg="":"";var e,f=d.dUnderScore(d.uEscp(a)).replace(d.sortPrefix,""),g=$.inArray(f,d.hidValue);g!==-1&&(d.hidValue.splice(g,1),e=JSON.stringify(d.hidValue)),0==d.hidValue.length&&(d.resetInpWidth(b),e=d.hidValue),d.inpHid.val(e),delete d.selectedValues[f],V.call(d,d.hidValue,d.selectedValues)},G=function(){var a,b=this,c=(b.id,"");if(a="all"==b.Allflg?"all":b.TagCnt,b.selectedCounter)if(b.TagCnt)if(b.showSelText&&b.hidValue.length){for(var d=0;d<b.hidValue.length;d++)c+=b.Ary.A[b.hidValue[d]]+", ";c=c.slice(0,-2),b.tagInSepContainer||b.tags===!1?b.inpElm.val(c):""}else(b.tagInSepContainer||b.tags===!1)&&(b.inpElm.attr({placeholder:b.preText+" "+a+" "+b.postText}),b.inpElm.val(""));else b.inpHid.val()||b.preserveText||(b.rootCont.find(".cross").hide(),b.checkBox&&b.inpElm.val(""),b.inpElm.css({width:""}))},H=function(){var a=this;a.inpElm.attr("placeholder",a.inpElm.data("placeholder")),a.inpElm.parents(".frst").css({"float-left":"none"})},I=function(a){var b=this,c=(b.id,0);b.dpLyr.find("ul li").each(function(){if($(this).attr("bindTo")==a.key){var d=$(this).children("a");if(d.length){var e=d.data("id");d.hasClass("chkd")&&(delete b.ChkBoxContr[b.uEscp(e.split("_")[1])],b.removeTag("tg_"+e+"_"+b.Escp(a.key),d.html(),!0))}c++,$(this).remove()}}),delete b.Ary[a.key],b.liCntr=b.liCntr-c,$("#ul_"+b.id).find("li").length||$("#"+b.id).find(".tagit").remove()},J=function(a){this.removeData(a)},K=function(a,b){var c=this.id;for(var d in a)this.CreateTags(a[d],c+"_"+d+"_A",0,b)},L=function(a){var b=this.id;for(var c in a.keyObject)this.removeTag("tg_"+b+"_"+a.keyObject[c]+"_A","",a.tag_onof_flag,a.remId)},M=function(a){var b=this,c=b.id;if(b.checkBox)for(var d in a.key){var e=a.key[d],f=b.sortPrefix?b.sortPrefix+e:e,g=b.optgrpNameRef[f];$.inArray(e[0],b.hidValue)==-1&&(g.pName?b.CreateTags(g.text,c+"_"+e+"_"+g.pName+"_A"):b.CreateTags(g.text,c+"_"+e+"_A"))}else{if(!b.optgrpNameRef[a.key])throw"DD: Key not exist";b.SingleSelection(b.optgrpNameRef[a.key].text,[c,a.key])}},N=function(a){var b=this,c=b.id;if(b.checkBox)for(var d in a.key){var e=a.key[d],f=b.sortPrefix?b.sortPrefix+e:e,g=b.optgrpNameRef[f];g.pName?b.removeTag("tg_"+c+"_"+a.key[d]+"_"+g.pName+"_A"):b.removeTag("tg_"+c+"_"+a.key[d]+"_A")}else{if(!b.optgrpNameRef[a.key])throw"DD: Key not exist";b.SingleSelection("",[c])}},O=function(a){var b=this,c={},d=[],e={};e[a.key]=a.data,$.extend(b.Ary,e),a.status||(a.status="Checked");var f=a.key?a.key:"A";if("Checked"==a.status){c[f]=a.data;var g=b.prefillDataFormation(a.prefillData);d[b.id]=g,b.NLi=b.appendData(c,d,g),$("#ul_"+b.id).find("ul").append(b.NLi[0]),b.createTags_ifPrefillData(b.NLi[2]),b.liCntr+=b.NLi[1]}else"Unchecked"==a.status&&this.removeBlockofData(a)},P=function(a){var b=this;b.id;if(b.checkBox&&a)for(var c=0;c<a.length;c++){for(var d in b.prefillData)if(b.prefillData[d]==a[c][3])break;b.CreateTags(a[c][0],a[c][1],d,b.tags)}b.setInputText()},Q=function(a){var b=this,c=b.id,d=a.isReset===!1?a.isReset:b.isReset,e=[],f=b.inpHid,g=$.trim(f.val());b.prefillData=a.prefillData;if(b.checkBox&&g&&(b.tagInSepContainer?$("#"+b.tagInSepContainer).find(".tagit").remove():b.rootCont.find(".DDsearch").find(".tagit").remove(),b.resetInpWidth(c),b.ChkBoxContr={},f.val(""),b.hidValue=[],b.TagCnt=0,b.setPlaceHolderAttribute()),d&&(b.inpElm.val(""),f.val("")),$.isEmptyObject(a.data))throw"Either data object is empty or undefined";b.Ary={A:a.data},b.ChkBoxContr=[];var h=b.prefillDataFormation(a.prefillData);e[c]=h;var i=b.appendData(b.Ary,e,h);b.dpLyr.find("ul").html(i[0]),b.createTags_ifPrefillData(i[2]),b.liCntr=i[1],b.firstHighlight(),b.max_height()},R=function(){var a=this;if(!a.preventClose){var b=a.id;if("block"==a.dpLyr.css("display")){if(a.dpLyr.hide(),a.rootCont.removeClass("open"),a.rootCont.find(".DDwrap").removeClass("brBotN"),!a.checkBox)if(a.curActElm?a.curActElm.removeClass("active"):"",a.selectOnBlur){var c,d=a.inpHid,f=a.inpElm,g=a.uEscp(d.attr("opt")),h=a.Ary.A,i=a.getKeyFromVal(a.Ary.A,f.val()),j=i.retKey;c=i.parentKey?g?h[g][d.val()]:h&&h[i.parentKey][j]?h[i.parentKey][j]:"":g?h[g][d.val()]:h&&h[j]?h[j]:"",a.inpHid.val()||a.preserveText||c||a.inpElm.val("")}else a.inpHid.val()||a.preserveText||a.inpElm.val("");a.setInputText()}a.searchBox!==!1&&a.setLi(b),e=0}},S=function(a){var b=this.hidValue,c=this.selectedValues;return{keys:b,object:c}},T=function(){this.prefillData=[],this.ChkBoxContr={},this.selectedValues={},this.init()},U=function(){this.inpElm.val(""),this.Fn.initSearch("",this.id,8)},V=function(a,b){this.onChangePrevent_onInit||this.onChange(a,b,this)};return{showDD:c,bindEvents:f,disable:g,enable:h,prefillDataFormation:k,removeAllTags:l,destroy:m,removeTag:n,fillData:o,appendData:p,chkForParent:q,Escp:r,uEscp:s,eUnderScore:t,dUnderScore:u,clickParent:v,clickMain:w,searchData:x,selChkBox:y,selCheckBox:z,createParLi:A,createLi:C,resetInpWidth:D,firstHighlight:E,emptyHidField:F,setInputText:G,setPlaceHolderAttribute:H,removeData:I,removeBlockofData:J,addSelected:K,deleteSelected:L,select:M,deselect:N,addData:O,createTags_ifPrefillData:P,replaceData:Q,hideDD:R,getSelectedValue:S,reset:T,resetSearch:U,onChangeHandler:V}}(),f.Ary={},f.lastRef={}});